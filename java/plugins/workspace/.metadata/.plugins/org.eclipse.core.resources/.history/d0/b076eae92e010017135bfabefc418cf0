package me.commandcraft.chestbank.bank;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.Location;
import org.bukkit.entity.HumanEntity;
import org.bukkit.entity.Player;
import org.bukkit.event.Listener;
import org.bukkit.event.inventory.InventoryCloseEvent;
import org.bukkit.event.inventory.InventoryOpenEvent;
import org.bukkit.inventory.Inventory;
import org.bukkit.inventory.InventoryHolder;
import org.bukkit.inventory.ItemStack;

import me.commandcraft.chestbank.ChestBank;
import me.commandcraft.chestbank.Utils;


public class Bank implements Listener {
	
	private List<Loc> locs;
	private Map<String, String[]> items;
	private String groupname;
	private int rows;
	
	public Bank(String groupname, int rows) {
		this.groupname = groupname;
		this.rows = rows;
		this.locs = new ArrayList<Loc>();
		this.items = new HashMap<String, String[]>();
	}
	
	public void addLoc(Location loc) {
		locs.add(new Loc(loc));
	}
	
	//Returns false if the location was not found
	public boolean onBankClick(InventoryOpenEvent event) {
		Player p = (Player) event.getPlayer();
		Location location = Utils.getTarget(p);
		if (location == null) return false;
		for (int i = 0; i < locs.size(); i++) {
			if (locs.get(i).equals(location)) {
				String[] groups = ChestBank.getPermission().getPlayerGroups(p);
				for (int j = 0; j < groups.length; j++) {
					if (groups[j].equals(groupname)) {
						//TODO open inventory;
						return true;
					}
				}
				p.sendMessage(ChatColor.RED + "You don't have permission to access that bank");
				return true;
			}
		}
		return false;
	}
	
	public void saveContents(Inventory inv, Player p) {
		ItemStack[] contents = inv.getContents();
		String[] items = new String[contents.length];
		for (int i = 0; i < contents.length; i++) {
			items[i] = Utils.toString(contents[i]);
		}
		this.items.put(p.getName(), items);
	}
	
	private void openBank(int index, HumanEntity p) {
		Inventory inv = Bukkit.createInventory(, rows*9, ChestBank.getConfiguration().getTitle());
		
	}
}